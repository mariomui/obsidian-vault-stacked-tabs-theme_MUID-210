@use "./shared/index.scss" as shared;
@use "sass:math";

//  make some extended thing so that both views are reusing styles

%dataview-container {
  // border: 2px solid var(--material-color-deep-orange);
  border: 2px solid shared.$borderColor;
  border-right-width: 1em;
  background-image: var(--dark-blue-grad);
  border-radius: 0.5em 0.5em;
  padding-left: 0.1em;
}

// # dataview

// ## Dataview:Shared between views
.markdown-source-view,
.markdown-reading-view {
  .block-language-dataview {
    border: 2px solid var(--material-color-deep-orange);
    border-radius: 1em 1em;
    background: var(--shade);
  }
}

// ## Dataview: Reading View
.markdown-reading-view {
  .markdown-preview-view.markdown-rendered {
    .markdown-preview-sizer.markdown-preview-section {
      .block-language-dataviewjs {
        @extend %dataview-container;
        padding: 0.5em 1em;
      }
      // Make the inner dataview box be 90% of the containing embed box
      > div:last-child {
        max-width: 90%;
      }
    }
  }
}

// # source view
.markdown-source-view {
  /* Remove scroll on embeds. */

  .internal-embed.markdown-embed.is-loaded[alt*="ui-noscroll"] {
    .markdown-embed-content {
      .markdown-preview-view.markdown-rendered.node-insert-event.show-indentation-guide
        .markdown-preview-sizer.markdown-preview-section {
        overflow: hidden;
      }
    }
  }

  .markdown-embed-content {
    .markdown-preview-view.markdown-rendered {
      .block-language-dataviewjs {
        p {
          width: 100% !important;
          background-color: shared.$callout;
          ul {
            margin: 0 !important;
          }
        }
        > div:first-of-type {
          background-color: shared.$accentAlt;
          ul {
            margin-top: 0.5em;
          }
        }
        li:has(span.internal-embed[alt*="=$"]) {
          & ~ li:nth-child(2n + 2) {
            border-top: 0.1em solid shared.$borderColor;
            background-color: shared.$callout;
          }
          & ~ li:nth-child(2n + 1) {
            background-color: shared.$calloutAlt;

            border-top: 0.1em solid shared.$borderColor;
          }
        }
      }
    }

    // .markdown-preview-view.markdown-rendered.node-insert-event.show-indentation-guide
    // .markdown-preview-sizer.markdown-preview-section {
    //   padding-left: 2rem;
    // }
  }
  .cm-preview-code-block.cm-embed-block.markdown-rendered {
    .block-language-dataviewjs {
      @extend %dataview-container;
      ul.dataview.list-view-ul:nth-of-type(1) {
        ul.dataview.dataview-ul.dataview-result-list-ul:nth-of-type(1) {
          li.dataview-result-list-li:has(ul) {
            li.dataview-result-list-li:not(:first-of-type) {
              a {
                color: shared.$embedPrimaryLinkColor;
              }
            }
          }
        }
      }
    }
  }
}

:is(.canvas-wrapper, .markdown-source-view) {
  .cm-preview-code-block.cm-embed-block.markdown-rendered {
    .internal-query {
      border: 2px solid shared.$embedBorderColor;
      max-height: 35vmin;
      overflow-y: scroll;
    }
  }

  .embedded-backlinks {
    .backlink-pane {
      max-height: 30vmin;
    }
  }

  .markdown-embed {
    .markdown-embed-link[aria-label="Open link"] {
      padding-top: 1em;
      margin-right: 1em;
      // pointer-events: none;
    }
  }

  // # OLK
  // hide transcluded headers for olk (omit linkage)
  .internal-embed[alt*="olk"].markdown-embed,
  .internal-embed[alt*="olk"].markdown-embed {
    .markdown-preview-sizer > div:nth-of-type(3) {
      display: none;
    }
    /*  ## OLK::Remove Scrollbar */
    .markdown-embed-title
      .markdown-preview-view.markdown-rendered.show-indentation-guide.allow-fold-headings.allow-fold-lists {
      overflow: hidden;
    }
    .markdown-preview-sizer.markdown-preview-section {
      padding: 0 !important;
      padding-left: 5px !important;
      pointer-events: none;
    }
    .markdown-embed-link[aria-label="Open link"] {
      display: none;
    }
  }
}

// ---------- end dataview section ---- ///

/** WORKING EMBED CONTAINER **/
// embedded content
.internal-embed.markdown-embed.inline-embed.is-loaded {
  padding-left: 1em !important;
  .markdown-preview-view.markdown-rendered {
    // padding so that the click to enter the embed link doesn't interfere with buttons.
    padding-top: 1.4em;
  }
}
/** : Tranclusion/Embed sections */

.internal-embed[alt*="nlk"].markdown-embed {
  /* hide file name on transcludes */
  .embed-title.markdown-embed-title {
    display: none;
  }
  // padding: 0 !important;
  // padding-left: 5px !important;
  .markdown-preview-sizer.markdown-preview-section {
    padding: 2em 0 0 0 !important;
    padding-left: 5px !important;
  }

  .markdown-preview-sizer > div:nth-of-type(3) {
    display: none;
  }
}

span[alt*="nlk"] {
  &.internal-embed.markdown-embed {
    padding: 0;
    .markdown-preview-sizer.markdown-preview-section {
      padding-left: 0 !important;
    }
  }
}

// # Reading View
.markdown-reading-view {
  .internal-embed[alt*="nlk"].markdown-embed
    .markdown-preview-sizer.markdown-preview-section {
    padding: 0 0 0 0 !important;
    padding-left: 0px !important;
    margin: 0;
  }

  // Reading view content container
  .markdown-preview-sizer.markdown-preview-section {
    /* level 2 */
    // margin: 0 2em;
    border-radius: 1.5em 1.5em;
    background: var(--shade);
  }
}

/** : Tranclusion/Embed sections */
.internal-embed[alt*="nlk"].markdown-embed {
  /* hide file name on transcludes */
}
.internal-embed[alt*="nlk"].markdown-embed .embed-title.markdown-embed-title {
  display: none;
}
.internal-embed[alt*="nlk"].markdown-embed
  .markdown-preview-sizer.markdown-preview-section {
  padding: 0.1em 0 0 0 !important;
  padding-left: 5px !important;
}
.internal-embed[alt*="nlk"].markdown-embed
  .markdown-preview-sizer
  > div:nth-of-type(3) {
  display: none;
}

span[alt*="nlk"].internal-embed.markdown-embed {
  padding: 0;
}
span[alt*="nlk"].internal-embed.markdown-embed
  .markdown-preview-sizer.markdown-preview-section {
  padding-left: 0 !important;
}

.markdown-reading-view
  .internal-embed[alt*="nlk"].markdown-embed
  .markdown-preview-sizer.markdown-preview-section {
  padding: 0 0 0 0 !important;
  padding-left: 0px !important;
  margin: 0;
}
